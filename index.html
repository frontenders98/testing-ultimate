<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A-Level Business | The One</title>
<link rel="icon" type="image/png" href="logo.png">
<style>
    /* GLOBAL FONT */
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@600;700&display=swap');

    :root {
        --lime-primary: #32CD32;
        --lime-dark: #228B22;
        --lime-light: #F0FFF0;
        --glass-bg: rgba(255, 255, 255, 0.95);
        --text-dark: #1a1a1a;
        --danger: #dc2626;
        --warning: #f59e0b;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Plus Jakarta Sans', sans-serif; background: linear-gradient(135deg, #f6fff6 0%, #e8f5e9 100%); color: var(--text-dark); min-height: 100vh; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

    /* CARD GRID STYLES */
    .section-title { font-family: 'Playfair Display', serif; font-size: 1.8rem; color: #1a1a1a; margin: 40px 0 20px 0; border-bottom: 3px solid var(--lime-primary); display: inline-block; }
    .grid-layout { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
    
    .info-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.05); position: relative; overflow: hidden; transition: transform 0.2s; }
    .info-card:hover { transform: translateY(-3px); border-color: var(--lime-primary); }
    
    .formula-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--lime-primary); }
    .def-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: #3b82f6; } /* Blue for definitions */

    .card-title { font-family: 'Inter', sans-serif; font-size: 0.85rem; font-weight: 700; color: #666; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
    .card-body { font-family: 'Inter', sans-serif; font-size: 1.1rem; font-weight: 500; color: #2c3e50; line-height: 1.4; }

    /* APP UI */
    .login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.9); z-index: 1000; }
    .login-card { background: white; padding: 40px; width: 350px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center; }
    .login-input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem; }
    
    .app-header { display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px 30px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
    .nav-btn { background: transparent; border: none; font-weight: 700; color: #666; padding: 10px 20px; cursor: pointer; font-size: 1rem; border-radius: 8px; }
    .nav-btn.active { background: var(--lime-light); color: var(--lime-dark); }

    .paper-card { background: white; padding: 25px; border-radius: 15px; cursor: pointer; transition: 0.3s; border: 2px solid transparent; box-shadow: 0 4px 15px rgba(0,0,0,0.03); margin-bottom: 15px; }
    .paper-card:hover { border-color: var(--lime-primary); transform: scale(1.01); }
    .paper-tag { padding: 4px 10px; background: #eee; border-radius: 6px; font-size: 0.8rem; font-weight: 700; margin-bottom: 8px; display: inline-block; }

    /* WORKSPACE */
    .workspace { display: grid; grid-template-columns: 1fr 1.2fr; gap: 30px; height: 80vh; }
    .insert-panel { background: #333; border-radius: 15px; overflow: hidden; height: 100%; }
    .questions-panel { overflow-y: auto; padding-right: 10px; height: 100%; }
    .question-card { background: white; padding: 30px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
    
    textarea { width: 100%; min-height: 200px; padding: 15px; border: 2px solid #eee; border-radius: 10px; margin: 15px 0 5px 0; font-family: inherit; font-size: 1rem; resize: vertical; }
    textarea:focus { border-color: var(--lime-primary); outline: none; }
    
    .word-count { text-align: right; font-size: 0.8rem; font-weight: 700; margin-bottom: 10px; }
    .word-count.good { color: var(--lime-dark); }
    .word-count.bad { color: var(--danger); }

    .submit-btn { background: var(--lime-dark); color: white; border: none; padding: 12px 25px; border-radius: 50px; font-weight: 700; cursor: pointer; width: 100%; font-size: 1rem; }
    .submit-btn:disabled { background: #ccc; }

    .feedback-box { margin-top: 20px; background: var(--lime-light); padding: 20px; border-radius: 12px; border: 1px solid var(--lime-primary); }
    .score-badge { display: inline-block; background: white; padding: 5px 10px; border-radius: 5px; font-weight: bold; margin-right: 5px; font-size: 0.9rem; border: 1px solid #ddd; }
    .model-ans { background: #222; color: #ddd; padding: 15px; border-radius: 8px; margin-top: 15px; font-size: 0.9rem; line-height: 1.5; white-space: pre-wrap; }

    .hidden { display: none !important; }
    .toggle-insert { display: none; margin-bottom: 15px; background: #eee; padding: 10px; text-align: center; border-radius: 10px; cursor: pointer; }
    @media (max-width: 900px) { .workspace { grid-template-columns: 1fr; height: auto; } .insert-panel { display: none; height: 400px; } .insert-panel.show { display: block; } .toggle-insert { display: block; } }
</style>
</head>
<body>

<div id="login-layer" class="login-screen">
    <div class="login-card">
        <h2>A-Level Business</h2>
        <input type="text" id="u-in" class="login-input" placeholder="username">
        <input type="password" id="p-in" class="login-input" placeholder="******">
        <button class="submit-btn" onclick="tryLogin()">Sign in</button>
    </div>
</div>

<div id="app-layer" class="hidden">
    <div class="container">
        <div class="app-header">
            <h2 style="color:var(--lime-dark); margin:0;">Business Practice</h2>
            <div class="nav">
                <button class="nav-btn active" onclick="setView('papers')">Papers</button>
                <button class="nav-btn" onclick="setView('formulae')">Formulae</button>
                <button class="nav-btn" onclick="setView('definitions')">Definitions</button>
                <button class="nav-btn" onclick="setView('scorecard')">Scorecard</button>
                <button class="nav-btn" onclick="doLogout()">Logout</button>
            </div>
        </div>

        <div id="view-papers">
            <h3 style="margin-bottom:15px; color:#888;">2024 Series</h3>
            <div class="grid-layout">
                <div class="paper-card" onclick="openPaper('2024_fm_32')">
                    <span class="paper-tag">Feb/March 2024</span>
                    <h3>Clean Delivery (CD)</h3>
                    <p style="color:#666; font-size:0.9rem;">Paper 32 ‚Ä¢ Strategy & Finance</p>
                </div>
                <div class="paper-card" onclick="openPaper('2024_mj_32')">
                    <span class="paper-tag">May/June 2024</span>
                    <h3>Soymai Farms (SF)</h3>
                    <p style="color:#666; font-size:0.9rem;">Paper 32 ‚Ä¢ Operations & Marketing</p>
                </div>
            </div>
            
            <h3 style="margin:30px 0 15px 0; color:#888;">2025 Series</h3>
            <div class="grid-layout">
                <div class="paper-card" onclick="openPaper('2025_fm_32')">
                    <span class="paper-tag">Feb/March 2025</span>
                    <h3>Iyipada (IPA)</h3>
                    <p style="color:#666; font-size:0.9rem;">Paper 32 ‚Ä¢ Change Management</p>
                </div>
            </div>
        </div>

        <div id="view-formulae" class="hidden">
            <div class="section-title">Finance: Ratios</div>
            <div class="grid-layout">
                <div class="info-card formula-card"><div class="card-title">Current Ratio</div><div class="card-body">Current Assets / Current Liabilities</div></div>
                <div class="info-card formula-card"><div class="card-title">ROCE</div><div class="card-body">(Operating Profit / Capital Employed) √ó 100</div></div>
                <div class="info-card formula-card"><div class="card-title">Gearing</div><div class="card-body">(Non-Current Liab / Capital Employed) √ó 100</div></div>
                <div class="info-card formula-card"><div class="card-title">Inventory Turnover</div><div class="card-body">Cost of Sales / Average Inventory</div></div>
            </div>
            <div class="section-title">Investment Appraisal</div>
            <div class="grid-layout">
                <div class="info-card formula-card"><div class="card-title">ARR</div><div class="card-body">(Avg Annual Profit / Avg Investment) √ó 100</div></div>
                <div class="info-card formula-card"><div class="card-title">Payback Period</div><div class="card-body">Initial Inv / Annual Net Cash Flow</div></div>
            </div>
        </div>

        <div id="view-definitions" class="hidden">
            
            <div class="section-title">Economics & Global Environment</div>
            <div class="grid-layout">
                <div class="info-card def-card"><div class="card-title">Privatization</div><div class="card-body">Selling state-owned organizations to investors in the private sector.</div></div>
                <div class="info-card def-card"><div class="card-title">Nationalization</div><div class="card-body">Transfer of privately owned businesses to state ownership.</div></div>
                <div class="info-card def-card"><div class="card-title">Monopoly</div><div class="card-body">A market with only one supplier and no close competitors.</div></div>
                <div class="info-card def-card"><div class="card-title">Globalization</div><div class="card-body">Increasing freedom of movement of goods, capital, and people around the world.</div></div>
                <div class="info-card def-card"><div class="card-title">Protectionism</div><div class="card-body">Using barriers (tariffs, quotas) to free trade to protect domestic industries.</div></div>
                <div class="info-card def-card"><div class="card-title">Tariff</div><div class="card-body">A tax imposed on an imported product.</div></div>
                <div class="info-card def-card"><div class="card-title">Quota</div><div class="card-body">A physical limit placed on the quantity of imports.</div></div>
                <div class="info-card def-card"><div class="card-title">GDP</div><div class="card-body">Total value of goods and services produced in a country in one year.</div></div>
                <div class="info-card def-card"><div class="card-title">Inflation</div><div class="card-body">Increase in average price level, resulting in a fall in the value of money.</div></div>
                <div class="info-card def-card"><div class="card-title">Recession</div><div class="card-body">Decline in real GDP over two or more consecutive quarters.</div></div>
                <div class="info-card def-card"><div class="card-title">Monetary Policy</div><div class="card-body">Decisions about interest rates and money supply.</div></div>
                <div class="info-card def-card"><div class="card-title">Fiscal Policy</div><div class="card-body">Decisions about government expenditure, tax rates, and borrowing.</div></div>
                <div class="info-card def-card"><div class="card-title">Exchange Rate Appreciation</div><div class="card-body">A rise in a currency's external value compared to other currencies.</div></div>
            </div>

            <div class="section-title">Strategic Management</div>
            <div class="grid-layout">
                <div class="info-card def-card"><div class="card-title">Strategic Management</div><div class="card-body">Setting long-term objectives and implementing strategies to achieve them.</div></div>
                <div class="info-card def-card"><div class="card-title">Blue Ocean Strategy</div><div class="card-body">Exploiting uncontested market space through differentiation and low cost.</div></div>
                <div class="info-card def-card"><div class="card-title">SWOT Analysis</div><div class="card-body">Analysis of internal Strengths/Weaknesses and external Opportunities/Threats.</div></div>
                <div class="info-card def-card"><div class="card-title">PEST Analysis</div><div class="card-body">Analysis of Political, Economic, Social, and Technological factors.</div></div>
                <div class="info-card def-card"><div class="card-title">Porter's Five Forces</div><div class="card-body">Technique for analysing competitive forces within an industry.</div></div>
                <div class="info-card def-card"><div class="card-title">Core Competence</div><div class="card-body">An essential capability providing competitive advantage.</div></div>
                <div class="info-card def-card"><div class="card-title">Ansoff Matrix</div><div class="card-body">Model showing risk in strategies: Penetration, Product/Market Dev, Diversification.</div></div>
                <div class="info-card def-card"><div class="card-title">Corporate Culture</div><div class="card-body">Values, attitudes, and beliefs influencing interaction within an organization.</div></div>
                <div class="info-card def-card"><div class="card-title">Transformational Leadership</div><div class="card-body">Leader works with teams to identify change and create a vision.</div></div>
                <div class="info-card def-card"><div class="card-title">Change Management</div><div class="card-body">Planning and controlling the transition of an organization to a new state.</div></div>
                <div class="info-card def-card"><div class="card-title">Project Champion</div><div class="card-body">Individual supporting a project and driving it forward.</div></div>
                <div class="info-card def-card"><div class="card-title">Contingency Planning</div><div class="card-body">Preparing resources to ensure business continuity after a crisis.</div></div>
            </div>

            <div class="section-title">HR & Organization</div>
            <div class="grid-layout">
                <div class="info-card def-card"><div class="card-title">Functional Structure</div><div class="card-body">Departments organised by specialist areas (e.g., marketing, finance).</div></div>
                <div class="info-card def-card"><div class="card-title">Matrix Structure</div><div class="card-body">Structure creating project teams cutting across functional departments.</div></div>
                <div class="info-card def-card"><div class="card-title">Delayering</div><div class="card-body">Removing one or more levels of hierarchy.</div></div>
                <div class="info-card def-card"><div class="card-title">Delegation</div><div class="card-body">Passing authority down the hierarchy.</div></div>
                <div class="info-card def-card"><div class="card-title">Centralisation</div><div class="card-body">Concentrating decision-making powers at the head office.</div></div>
                <div class="info-card def-card"><div class="card-title">Emotional Intelligence</div><div class="card-body">Ability to understand and manage emotions of self and others.</div></div>
                <div class="info-card def-card"><div class="card-title">Hard HRM</div><div class="card-body">Managing employees focused on cutting costs.</div></div>
                <div class="info-card def-card"><div class="card-title">Soft HRM</div><div class="card-body">Managing employees focused on development and motivation.</div></div>
                <div class="info-card def-card"><div class="card-title">Gig Economy</div><div class="card-body">Labor market with temporary, flexible jobs (independent contractors).</div></div>
                <div class="info-card def-card"><div class="card-title">Absenteeism</div><div class="card-body">Rate of workforce absence as a proportion of total employees.</div></div>
            </div>

            <div class="section-title">Marketing</div>
            <div class="grid-layout">
                <div class="info-card def-card"><div class="card-title">Price Elasticity (PED)</div><div class="card-body">Measure of how demand changes in response to price changes.</div></div>
                <div class="info-card def-card"><div class="card-title">Product Development</div><div class="card-body">Creating and marketing new goods/services.</div></div>
                <div class="info-card def-card"><div class="card-title">Sales Forecasting</div><div class="card-body">Predicting future sales levels and trends.</div></div>
                <div class="info-card def-card"><div class="card-title">Delphi Method</div><div class="card-body">Qualitative forecasting gathering forecasts from a panel of experts.</div></div>
                <div class="info-card def-card"><div class="card-title">Global Localisation</div><div class="card-body">Adjusting marketing mix to suit local tastes while maintaining global strategy.</div></div>
                <div class="info-card def-card"><div class="card-title">Pan-Global Marketing</div><div class="card-body">Marketing a standardised product worldwide as if it were a single market.</div></div>
            </div>

            <div class="section-title">Operations</div>
            <div class="grid-layout">
                <div class="info-card def-card"><div class="card-title">Reshoring</div><div class="card-body">Moving a previously offshored operation back to the original country.</div></div>
                <div class="info-card def-card"><div class="card-title">Economies of Scale</div><div class="card-body">Cost reductions per unit achieved as a business expands.</div></div>
                <div class="info-card def-card"><div class="card-title">Total Quality Management</div><div class="card-body">Quality approach involving all employees in continuous improvement.</div></div>
                <div class="info-card def-card"><div class="card-title">Lean Production</div><div class="card-body">Producing goods with minimal waste while maintaining quality.</div></div>
                <div class="info-card def-card"><div class="card-title">Kaizen</div><div class="card-body">Japanese term meaning continuous improvement.</div></div>
                <div class="info-card def-card"><div class="card-title">Critical Path Analysis</div><div class="card-body">Technique identifying task sequences and the critical path.</div></div>
                <div class="info-card def-card"><div class="card-title">Total Float</div><div class="card-body">Time an activity can be delayed without delaying the project.</div></div>
            </div>

            <div class="section-title">Finance</div>
            <div class="grid-layout">
                <div class="info-card def-card"><div class="card-title">Working Capital</div><div class="card-body">Capital for day-to-day activities (Current Assets - Current Liabilities).</div></div>
                <div class="info-card def-card"><div class="card-title">Depreciation</div><div class="card-body">Reduction in estimated value of a non-current asset over time.</div></div>
                <div class="info-card def-card"><div class="card-title">Goodwill</div><div class="card-body">Value arising when a business is bought for more than asset value.</div></div>
                <div class="info-card def-card"><div class="card-title">Window Dressing</div><div class="card-body">Manipulating financial statements to show more favorable results.</div></div>
                <div class="info-card def-card"><div class="card-title">Capital Employed</div><div class="card-body">Total value of long-term finance invested in a business.</div></div>
                <div class="info-card def-card"><div class="card-title">Investment Appraisal</div><div class="card-body">Evaluating profitability/feasibility of an investment (NPV, ARR).</div></div>
            </div>

        </div>

        <div id="view-scorecard" class="hidden">
            <h2 class="section-title">Performance</h2>
            <div id="stats-overview" style="display:flex; gap:20px; margin-bottom:30px;"></div>
            <div id="score-table-container"></div>
            <button onclick="if(confirm('Reset all?')) { localStorage.clear(); location.reload(); }" style="margin-top:20px; color:red; background:none; border:1px solid red; padding:10px; border-radius:5px; cursor:pointer;">Reset Data</button>
        </div>

        <div id="view-workspace" class="hidden">
            <button class="nav-btn" onclick="setView('papers')">‚Üê Back</button>
            <div class="toggle-insert" onclick="toggleInsert()">üìñ Toggle Case Study</div>
            <div class="workspace">
                <div class="insert-panel" id="insert-panel">
                    <iframe id="insert-pdf" style="width:100%; height:100%; border:none;" src=""></iframe>
                </div>
                <div class="questions-panel" id="questions-container"></div>
            </div>
        </div>
    </div>
</div>

<script>
// === CORRECTED DATA BASED ON YOUR INSERTS ===
const paperData = {
    '2024_fm_32': { 
        title: "Clean Delivery (CD)", 
        pdf: "9609_m24_in_32.pdf", 
        questions: [ 
            { n:'1', m:8, t:'Analyse two benefits to CD resulting from internal economies of scale.', l:'150-225'}, 
            { n:'2', m:8, t:'Analyse two advantages to CD of changing to a geographical organisational structure.', l:'150-225'}, 
            { n:'3(a)', m:2, t:'Calculate the Price Earnings (P/E) ratio for 2024.'}, 
            { n:'3(b)', m:2, t:'Calculate the Return on Capital Employed (ROCE) for 2024.'}, 
            { n:'3(c)', m:12, t:'Evaluate the usefulness of ratio analysis to CD‚Äôs directors.', l:'250-350'}, 
            { n:'4(a)', m:4, t:'Calculate the difference in capacity utilisation between 2022 and 2023.'}, 
            { n:'4(b)', m:12, t:'Evaluate the importance of research and development (R&D) to CD‚Äôs future success.', l:'250-350'}, 
            { n:'5', m:12, t:'Evaluate the impact on CD of the appreciation of country K‚Äôs exchange rate.', l:'250-350'} 
        ] 
    },
    '2024_mj_32': { 
        title: "Soymai Farms (SF)", 
        pdf: "9609_s24_in_32.pdf", 
        questions: [ 
            { n:'1', m:8, t:'Analyse two advantages to SF of using flexible employment contracts.', l:'150-225'}, 
            { n:'2', m:8, t:'Analyse two problems SF may experience when implementing TQM.', l:'150-225'}, 
            { n:'3(a)', m:2, t:'Calculate the sales volume variation for Quarter 1 2023.'}, 
            { n:'3(b)', m:2, t:'Calculate the centred quarterly moving average for Quarter 2 2023.'}, 
            { n:'3(c)', m:12, t:'Evaluate the usefulness of sales forecasting to SF.', l:'250-350'}, 
            { n:'4(a)', m:4, t:'Calculate the current capacity utilisation of the factory.'}, 
            { n:'4(b)', m:12, t:'Evaluate the decision to outsource production of Sosoy Ice Cream.', l:'250-350'}, 
            { n:'5', m:12, t:'Evaluate the impact on SF of joining the NFTA trading agreement.', l:'250-350'} 
        ] 
    },
    '2025_fm_32': { 
        title: "Iyipada (IPA)", 
        pdf: "9609_m25_in_32.pdf", 
        questions: [ 
            { n:'1', m:8, t:'Analyse one advantage and one disadvantage to IPA of changing employment contracts.', l:'150-225'}, 
            { n:'5', m:12, t:'Evaluate the most likely impact on IPA of the fiscal and monetary policy changes.', l:'250-350'} 
        ] 
    }
};

function getUser() { return localStorage.getItem('user'); }
function getAttempts(u) { return JSON.parse(localStorage.getItem(`attempts_${u}`) || '{}'); }
function saveAttempt(u, pid, qn, data) {
    const atts = getAttempts(u);
    if(!atts[pid]) atts[pid] = {};
    atts[pid][qn] = data;
    localStorage.setItem(`attempts_${u}`, JSON.stringify(atts));
}

function tryLogin() {
    const u = document.getElementById('u-in').value.trim();
    const p = document.getElementById('p-in').value.trim();
    if(p === '011406' && u.includes('.') && u.split('.').length >= 2) {
        localStorage.setItem('user', u);
        document.getElementById('login-layer').classList.add('hidden');
        document.getElementById('app-layer').classList.remove('hidden');
        setView('papers');
    } else { alert("Incorrect Credentials."); }
}

function doLogout() { localStorage.removeItem('user'); location.reload(); }

function setView(viewName) {
    ['papers', 'scorecard', 'workspace', 'formulae', 'definitions'].forEach(v => document.getElementById(`view-${v}`).classList.add('hidden'));
    document.getElementById(`view-${viewName}`).classList.remove('hidden');
    if(viewName === 'scorecard') renderScorecard();
}

function openPaper(pid) {
    const data = paperData[pid];
    const u = getUser();
    const attempts = getAttempts(u)[pid] || {};
    document.getElementById('insert-pdf').src = data.pdf;
    
    let html = `<h2>${data.title}</h2>`;
    data.questions.forEach(q => {
        const att = attempts[q.n] || {};
        const done = att.score !== undefined;
        html += `
        <div class="question-card">
            <div style="display:flex; justify-content:space-between;"><strong>Q${q.n}</strong><span>${q.m} Marks</span></div>
            <p style="margin:10px 0; font-weight:500;">${q.t}</p>
            ${q.l ? `<p style="font-size:0.8rem; color:#666;">Limit: ${q.l} words</p>` : ''}
            
            <textarea id="ans_${pid}_${q.n}" oninput="checkWords(this, '${q.l}')">${att.answer || ''}</textarea>
            <div id="wc_${pid}_${q.n}" class="word-count">0 words</div>

            <button class="submit-btn" onclick="submitAns('${pid}', '${q.n}')" ${done ? '' : ''}>${done ? 'Re-Evaluate' : 'Strict Mark'}</button>
            
            ${done ? `<div class="feedback-box">
                <h3>Score: ${att.score}/${q.m}</h3>
                <div style="margin:10px 0;">
                    <span class="score-badge">AO1: ${att.ao1}</span>
                    <span class="score-badge">AO2: ${att.ao2}</span>
                    <span class="score-badge">AO3: ${att.ao3}</span>
                    <span class="score-badge">AO4: ${att.ao4}</span>
                </div>
                <p><strong>Strengths:</strong> ${att.strengths}</p>
                <p><strong>Improvements:</strong> <span style="color:#d63031">${att.weaknesses}</span></p>
                <div class="model-ans"><strong>Model Answer:</strong><br>${att.modelAnswer}</div>
            </div>` : ''}
        </div>`;
    });
    document.getElementById('questions-container').innerHTML = html;
    setView('workspace');
    data.questions.forEach(q => checkWords(document.getElementById(`ans_${pid}_${q.n}`), q.l));
}

function checkWords(el, limit) {
    if(!limit) return;
    const count = el.value.trim().split(/\s+/).filter(w => w.length > 0).length;
    const [min, max] = limit.split('-').map(Number);
    const wcDiv = document.getElementById(el.id.replace('ans', 'wc'));
    wcDiv.innerText = `${count} words`;
    wcDiv.className = (count >= min && count <= max) ? 'word-count good' : 'word-count bad';
}

function toggleInsert() { document.getElementById('insert-panel').classList.toggle('show'); }

async function submitAns(pid, qn) {
    const el = document.getElementById(`ans_${pid}_${qn}`);
    const btn = event.target;
    btn.disabled = true; btn.innerText = "Marking...";
    
    try {
        // === CRITICAL: POINTING TO YOUR HOSTED SERVER ===
        const res = await fetch('https://ultimate-exam-guide.onrender.com/mark', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                question: paperData[pid].questions.find(q => q.n === qn).t,
                marks: paperData[pid].questions.find(q => q.n === qn).m,
                case_study: `Refer to PDF ${paperData[pid].title}`,
                answer: el.value
            })
        });
        const data = await res.json();
        saveAttempt(getUser(), pid, qn, data);
        openPaper(pid);
    } catch(e) {
        alert("Server Error. Check console.");
        btn.disabled = false; btn.innerText = "Retry";
    }
}

function renderScorecard() {
    const u = getUser();
    const atts = getAttempts(u);
    let html = '';
    let total = 0, max = 0;
    
    Object.keys(paperData).forEach(pid => {
        const pAtts = atts[pid] || {};
        let pScore = 0;
        Object.values(pAtts).forEach(a => pScore += (a.score || 0));
        html += `<div style="background:white; padding:15px; margin-bottom:10px; border-radius:10px; border:1px solid #eee; display:flex; justify-content:space-between;">
            <span>${paperData[pid].title}</span>
            <strong style="color:var(--lime-dark);">${pScore} Marks</strong>
        </div>`;
    });
    document.getElementById('score-table-container').innerHTML = html;
}

if(getUser()) {
    document.getElementById('login-layer').classList.add('hidden');
    document.getElementById('app-layer').classList.remove('hidden');
    setView('papers');
}
</script>
</body>
</html>